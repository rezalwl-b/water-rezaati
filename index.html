<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÛŒØ§Ø¯Ø¢ÙˆØ± Û¸ Ù„ÛŒÙˆØ§Ù† Ø¢Ø¨ â€” Ù†ÙˆØ´ÛŒØ¯Ù† Ø¢Ø¨</title>
  <style>
    :root{
      --bg:#E9F7FF;--card:#ffffff;--accent:#2aa7ff;--glass-border:#c6e7ff;
      --water:#7fd3ff;--muted:#6b6b6b;
      font-family:'Vazirmatn',system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#f8ffff)}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:2rem}
    .card{width:100%;max-width:1000px;background:var(--card);border-radius:20px;box-shadow:0 10px 30px rgba(60,120,150,.12);padding:28px;display:grid;grid-template-columns:1fr 380px;gap:20px;align-items:start}
    h1{margin:0 0 6px 0;font-size:20px;text-align:right}
    p.lead{margin:0 0 18px 0;color:var(--muted);text-align:right}

    .glasses{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .glass{background:linear-gradient(180deg,rgba(255,255,255,.8),rgba(255,255,255,.6));border-radius:14px;padding:10px;border:2px solid var(--glass-border);display:flex;flex-direction:column;align-items:center;justify-content:flex-end;cursor:pointer;transition:transform .18s ease,box-shadow .18s}
    .glass:active{transform:scale(.98)}
    .glass .cup{width:100%;height:120px;border-radius:10px;position:relative;overflow:hidden;background:rgba(255,255,255,.5);display:flex;align-items:flex-end;justify-content:center}
    .water{position:absolute;left:0;right:0;bottom:0;height:0%;background:linear-gradient(180deg,var(--water),#56b8f0);transition:height .6s cubic-bezier(.2,.9,.3,1)}
    .label{margin-top:10px;font-weight:600;color:#0b6aa6}
    .glass.filled{box-shadow:0 8px 18px rgba(34,149,214,.12);border-color:rgba(42,167,255,.6)}

    .side{display:flex;flex-direction:column;gap:16px;align-items:stretch}
    .stage{display:flex;align-items:center;justify-content:center;min-height:220px;background:linear-gradient(180deg,#eafff1,#f6fff6);border:1px solid rgba(120,210,140,.18);border-radius:16px;position:relative;overflow:hidden}
    .char-emoji{font-size:140px;line-height:1;filter:drop-shadow(0 8px 16px rgba(0,0,0,.08));transition:transform .35s ease}
    .char-emoji.happy{transform:translateY(-8px) scale(1.1) rotate(-2deg)}
    .char-emoji.angry{animation:shake .6s ease;transform:scale(1.04)}
    @keyframes shake{0%,100%{transform:translateX(0) scale(1.04)}25%{transform:translateX(-6px) scale(1.04)}50%{transform:translateX(5px) scale(1.04)}75%{transform:translateX(-4px) scale(1.04)}}
    .spark{position:absolute;font-size:28px;opacity:0;transform:translate(-50%,-50%) scale(.6);animation:spark .9s ease forwards}
    @keyframes spark{to{opacity:1;transform:translate(-50%,-50%) scale(1);}}

    .meter{width:100%;height:12px;background:linear-gradient(90deg,#e6f7ff,#e6fff6);border-radius:10px;overflow:hidden}
    .meter>i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#7fe1a3);transition:width .6s cubic-bezier(.2,.9,.3,1)}

    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{appearance:none;border:0;padding:10px 12px;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;color:var(--muted);border:1px solid #dfeffb}

    .char-picker{display:flex;gap:8px;flex-wrap:wrap}
    .char-card{display:flex;align-items:center;gap:8px;border:1px solid #e6eef7;border-radius:12px;padding:8px 10px;cursor:pointer;user-select:none}
    .char-card input{accent-color:var(--accent)}

    .toast{position:fixed;left:50%;top:18px;transform:translateX(-50%);background:#0b6aa6;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 10px 24px rgba(0,0,0,.12);opacity:0;pointer-events:none;transition:opacity .25s ease;z-index:11}
    .toast.show{opacity:1}

    /* Ú©Ø§Ù†ÙˆØ³ Ùˆ Ù¾ÛŒØ§Ù… Ø¨Ø²Ø±Ú¯ */
    #confetti{position:fixed;inset:0;pointer-events:none;z-index:10}
    #bigMsg{
      position:fixed;left:50%;top:0;transform:translateX(-50%); /* Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ */
      display:flex;align-items:center;justify-content:center;
      width:min(1100px, 92vw); padding:18px 24px; margin-top:10px;
      font-weight:900;font-size: clamp(26px, 5.6vw, 64px);line-height:1.25;text-align:center;
      color:#000; text-shadow:0 2px 10px rgba(255,255,255,.6);
      background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.75));
      border:1px solid rgba(0,0,0,.08); border-radius:16px;
      z-index:12;opacity:0;pointer-events:none;
    }
    #bigMsg.show{animation:popIn .9s cubic-bezier(.2,.9,.3,1) forwards}
    @keyframes popIn{
      0%{opacity:0;transform:translateX(-50%) scale(.94)}
      60%{opacity:1;transform:translateX(-50%) scale(1.02)}
      100%{opacity:1;transform:translateX(-50%) scale(1)}
    }

    /* Ø§Ø­ØªØ±Ø§Ù… Ø¨Ù‡ Ú©Ø§Ù‡Ø´ Ù…ÙˆØ´Ù† */
    @media (prefers-reduced-motion: reduce) {
      .water,.char-emoji,.spark,.meter>i,#bigMsg.show{transition:none !important; animation:none !important;}
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <div id="bigMsg"></div>
  <div class="toast" id="toast"></div>

  <div class="wrap">
    <div class="card">
      <div>
        <h1>ÛŒØ§Ø¯Ø¢ÙˆØ± Ù†ÙˆØ´ÛŒØ¯Ù† Ø±ÙˆØ²ÛŒ Û¸ Ù„ÛŒÙˆØ§Ù† Ø¢Ø¨</h1>
        <p class="lead">Ù‡Ø± Ù„ÛŒÙˆØ§Ù† Ø±Ø§ Ú©Ù‡ Ù†ÙˆØ´ÛŒØ¯ÛŒ Ø¨Ø²Ù† Ø±ÙˆÛŒØ´ ØªØ§ Ù¾Ø± Ø´ÙˆØ¯ â€” Â«Ø§Ù‚Ø§ÛŒ Ø±Ø¶Ø§Ø¦ØªÛŒÂ» (Ø­ÛŒÙˆØ§Ù† Ø§Ù†ØªØ®Ø§Ø¨ÛŒ) Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯!</p>
        <div class="glasses" id="glasses"></div>
        <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;align-items:center">
          <div style="text-align:right">
            <div style="font-size:13px;color:#6b6b6b">Ù†ÙˆØ´ÛŒØ¯Ù‡ Ø´Ø¯Ù‡</div>
            <div id="count" style="font-weight:800;font-size:18px">0 / 8</div>
          </div>
          <div style="flex:1"></div>
          <div class="controls">
            <label style="font-size:13px;color:#555;display:flex;align-items:center;gap:6px">
              Ø²Ù…Ø§Ù† ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ (Ø¯Ù‚ÛŒÙ‚Ù‡):
              <input id="remInput" type="number" min="1" value="60" style="width:74px;padding:5px;border:1px solid #ccc;border-radius:6px;text-align:center">
            </label>
            <button id="reset">ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬Ø¯Ø¯</button>
          </div>
        </div>
      </div>

      <aside class="side">
        <div class="stage" id="stage"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
          <div style="font-weight:800">Ù¾ÛŒØ´Ø±ÙØª Ø±ÙˆØ²</div>
          <div class="meter" style="flex:1"><i id="meterBar" style="width:0%"></i></div>
        </div>
        <div>
          <div style="font-weight:700;margin:6px 0 8px">Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø®ØµÛŒØª Â«Ø§Ù‚Ø§ÛŒ Ø±Ø¶Ø§Ø¦ØªÛŒÂ» ğŸ¾</div>
          <div class="char-picker" id="charPicker"></div>
        </div>
      </aside>
    </div>
  </div>

<script>
// ===== Characters =====
const CHARACTERS={
  cat :{name:'Ú¯Ø±Ø¨Ù‡', normal:'ğŸ±', happy:'ğŸ˜º', angry:'ğŸ˜¾'},
  dog :{name:'Ø³Ú¯',   normal:'ğŸ¶', happy:'ğŸ¶', angry:'ğŸ˜ '},
  cow :{name:'Ú¯Ø§Ùˆ',  normal:'ğŸ®', happy:'ğŸ®', angry:'ğŸ˜ '},
  lion:{name:'Ø´ÛŒØ±',  normal:'ğŸ¦', happy:'ğŸ¦', angry:'ğŸ˜ '},
  panda:{name:'Ù¾Ø§Ù†Ø¯Ø§',normal:'ğŸ¼', happy:'ğŸ¼', angry:'ğŸ˜ '}
};
let selected=localStorage.getItem('char')||'cat';
let state=(()=>{try{const s=JSON.parse(localStorage.getItem('drinkState'));if(Array.isArray(s)&&s.length===8)return s.map(Boolean);}catch(e){}return Array(8).fill(false)})();

// ===== DOM =====
const glassesEl=document.getElementById('glasses');
const countEl=document.getElementById('count');
const meterBar=document.getElementById('meterBar');
const stage=document.getElementById('stage');
const toast=document.getElementById('toast');
const bigMsg=document.getElementById('bigMsg');

// ===== Confetti Canvas =====
const confettiCanvas=document.getElementById('confetti');
const ctx=confettiCanvas.getContext('2d');
function sizeCanvas(){
  confettiCanvas.width=window.innerWidth;
  confettiCanvas.height=Math.max(window.innerHeight, document.body.scrollHeight);
}
addEventListener('resize',sizeCanvas); sizeCanvas();

let confettiRaf=null;
function clearConfetti(){
  if(confettiRaf){ cancelAnimationFrame(confettiRaf); confettiRaf=null; }
  confettiCanvas.style.transition='opacity .4s ease';
  confettiCanvas.style.opacity='0';
  setTimeout(()=>{
    ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    confettiCanvas.width=confettiCanvas.width; // reset buffer
    confettiCanvas.style.opacity='1';
  },420);
  bigMsg.classList.remove('show');
  bigMsg.style.opacity='0';
}

// ===== UI helpers =====
function save(){localStorage.setItem('drinkState',JSON.stringify(state));localStorage.setItem('char',selected)}
function renderGlasses(){
  glassesEl.innerHTML='';
  for(let i=0;i<8;i++){
    const b=document.createElement('button');
    b.className='glass'+(state[i]?' filled':'');
    b.innerHTML=`<div class='cup'><div class='water' style='height:${state[i]?'85%':'0%'}'></div></div><div class='label'>Ù„ÛŒÙˆØ§Ù† ${i+1}</div>`;
    b.onclick=()=>toggle(i,b);
    glassesEl.appendChild(b);
  }
}
function renderStage(){
  stage.innerHTML='';
  const span=document.createElement('span');
  span.className='char-emoji';
  span.textContent=CHARACTERS[selected].normal;
  stage.appendChild(span);
}
function renderPicker(){
  const p=document.getElementById('charPicker'); p.innerHTML='';
  for(const [k,v] of Object.entries(CHARACTERS)){
    const label=document.createElement('label');
    label.className='char-card';
    label.innerHTML=`<input type='radio' name='char' value='${k}' ${selected===k?'checked':''}> ${v.name}`;
    label.querySelector('input').onchange=()=>{selected=k;save();renderStage()};
    p.appendChild(label);
  }
}
function showToast(m){toast.textContent=m;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),1300)}
function face(mode){
  const el=stage.querySelector('.char-emoji'); if(!el) return;
  const f=CHARACTERS[selected];
  if(mode==='happy'){
    el.textContent=f.happy; el.classList.add('happy');
    setTimeout(()=>{el.textContent=f.normal; el.classList.remove('happy')},900);
  }else if(mode==='angry'){
    el.textContent=f.angry; el.classList.add('angry');
    setTimeout(()=>{el.textContent=f.normal; el.classList.remove('angry')},900);
  }
}
function sparkle(set=['âœ¨','ğŸ’–','ğŸ’¦']){
  for(let i=0;i<3;i++){
    const s=document.createElement('div');
    s.className='spark';
    s.textContent=set[i%set.length];
    s.style.left=(50+(Math.random()*40-20))+'%';
    s.style.top=(45+(Math.random()*30-15))+'%';
    stage.appendChild(s);
    setTimeout(()=>s.remove(),900);
  }
}
function getDone(){return state.filter(Boolean).length}
function update(){
  const done=getDone();
  countEl.textContent=`${done} / 8`;
  meterBar.style.width=`${(done/8)*100}%`;
}

// ===== Notification permission (ask once) =====
const NOTIF_FLAG = 'notifAskedV1';
let notifAsked = localStorage.getItem(NOTIF_FLAG) === '1';

async function askNotifOnce(){
  if (notifAsked || !('Notification' in window)) return Notification?.permission === 'granted';
  if (Notification.permission !== 'default') {
    notifAsked = true; localStorage.setItem(NOTIF_FLAG, '1');
    return Notification.permission === 'granted';
  }
  try{
    const res = await Notification.requestPermission();
    notifAsked = true; localStorage.setItem(NOTIF_FLAG, '1');
    return res === 'granted';
  }catch{
    notifAsked = true; localStorage.setItem(NOTIF_FLAG, '1');
    return false;
  }
}

// ===== Notifications: timing & schedule (user-configurable) =====
let reminderTimer = null;
// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ù‚ÛŒÙ‚Ù‡ (Ù‚Ø§Ø¨Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ø² UI Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage)
let reminderMinutes = Number(localStorage.getItem('remMinutes')) || 60;
function getReminderMs(){ return reminderMinutes * 60 * 1000; }

function showWaterNotification(msg='ÙˆÙ‚ØªÙ Ø¢Ø¨ Ø®ÙˆØ±Ø¯Ù†Ù‡ ğŸ’§'){
  if (!('Notification' in window) || Notification.permission!=='granted') return;
  try{
    new Notification('ÛŒØ§Ø¯Ø¢ÙˆØ± Ø¢Ø¨',{ body: msg, dir:'rtl', silent:false });
  }catch(e){
    // fallback Ø³Ø§Ø¯Ù‡
    console.warn('Notification failed, fallback alert:', e);
    alert(msg);
  }
}

function scheduleNextReminder(delayMs){
  clearTimeout(reminderTimer);
  reminderTimer = setTimeout(()=>{
    if (getDone() < 8){
      showWaterNotification('ÛŒÙ‡ Ù„ÛŒÙˆØ§Ù† Ø¯ÛŒÚ¯Ù‡ Ø¨Ø²Ù† Ú©Ù‡ Ø¨Ø±Ø³ÛŒ Ø¨Ù‡ Û¸ ØªØ§! ğŸ’ª');
      const nextAt = Date.now() + getReminderMs();
      localStorage.setItem('nextReminderAt', String(nextAt));
      scheduleNextReminder(getReminderMs());
    } else {
      stopHourlyReminders();
    }
  }, Math.max(1000, delayMs));
}

function startHourlyReminders(fromTs){
  const nextAt = fromTs + getReminderMs();
  localStorage.setItem('nextReminderAt', String(nextAt));
  scheduleNextReminder(nextAt - Date.now());
}

function stopHourlyReminders(){
  clearTimeout(reminderTimer);
  reminderTimer=null;
  localStorage.removeItem('nextReminderAt');
}

// Ø¨Ø¹Ø¯ Ø§Ø² Ø±ÙØ±Ø´ ØµÙØ­Ù‡ Ù‡Ù… Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡
(function resumeHourlyOnLoad(){
  const saved = Number(localStorage.getItem('nextReminderAt')||0);
  if (!saved) return;
  if (getDone() >= 8){ stopHourlyReminders(); return; }
  const diff = saved - Date.now();
  if (diff <= 0){
    askNotifOnce().then(granted=>{
      if (!granted) return;
      showWaterNotification();
      const nextAt = Date.now() + getReminderMs();
      localStorage.setItem('nextReminderAt', String(nextAt));
      scheduleNextReminder(getReminderMs());
    });
  } else {
    scheduleNextReminder(diff);
  }
})();

// ===== Logic =====
function toggle(i,el){
  const doneBefore=getDone();

  const was=state[i];
  state[i]=!state[i];

  const w=el.querySelector('.water');
  el.classList.toggle('filled',state[i]);
  w.style.height=state[i]?'85%':'0%';
  save();

  // Ø§Ø¬Ø§Ø²Ù‡ Ù†ÙˆØªÛŒÙ ÙÙ‚Ø· ÛŒÚ©â€ŒØ¨Ø§Ø± + Ø´Ø±ÙˆØ¹ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø² Ù‡Ù…ÛŒÙ† Ù„Ø­Ø¸Ù‡
  if (state[i]) {
    askNotifOnce().then(granted=>{
      if (granted && getDone() < 8) startHourlyReminders(Date.now());
    });
  }

  if(state[i]){ face('happy'); sparkle(['âœ¨','ğŸ’–','ğŸ’¦']); showToast(`Ø§Ù‚Ø§ÛŒ Ø±Ø¶Ø§Ø¦ØªÛŒ (${CHARACTERS[selected].name}) Ø®ÙˆØ´Ø­Ø§Ù„ Ø´Ø¯!`) }
  else{ face('angry'); sparkle(['ğŸ’¢','ğŸ’¢','ğŸ˜¤']); showToast('Ø§Ù‚Ø§ÛŒ Ø±Ø¶Ø§Ø¦ØªÛŒ Ú¯ÙØª: ÙˆØ§Ø³Ù‡ Ú†ÛŒ Ø®Ø§Ù„ÛŒ Ú©Ø±Ø¯ÛŒ Ù„Ø§Ø´ÛŒØŸ! ğŸ˜ ') }

  const doneAfter=getDone();
  if(doneBefore<8 && doneAfter===8){ celebrateExplosion(); stopHourlyReminders(); }
  update();
}

function resetAll(){
  state=Array(8).fill(false);
  save(); renderGlasses(); update();
  clearConfetti();
  stopHourlyReminders();
}

// ===== Explosion Confetti + Top Big Message =====
function celebrateExplosion(){
  sizeCanvas();
  face('happy');

  // Ù¾ÛŒØ§Ù… Ø¨Ø²Ø±Ú¯ Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡
  bigMsg.textContent='Ø§Ù‚Ø§ÛŒ Ø±Ø¶Ø§Ø¦ØªÛŒ Ø®ÛŒÙ„ÛŒ Ø®ÛŒÙ„ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ Ø´Ø¯ Ú©Ù‡ 8 ØªØ§ØªÙˆ Ú©Ø§Ù…Ù„ Ú©Ø±Ø¯ÛŒ';
  bigMsg.style.opacity='1';
  bigMsg.classList.add('show');

  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if(prefersReduced){
    showToast('Ø¢ÙØ±ÛŒÙ†! Û¸ Ù„ÛŒÙˆØ§Ù† Ú©Ø§Ù…Ù„ Ø´Ø¯ ğŸ‰');
    setTimeout(()=>{ bigMsg.classList.remove('show'); bigMsg.style.opacity='0'; }, 4200);
    return;
  }

  const W=confettiCanvas.width, H=confettiCanvas.height;

  // Ø´Ø¹Ø§Ø¹ Ùˆ Ù¾ÙˆØ´Ø´ Ø¨ÛŒØ´ØªØ±: ØªØ¹Ø¯Ø§Ø¯ Ùˆ Ø³Ø±Ø¹Øª Ø¨Ø§Ù„Ø§ØªØ± + Ú†Ù†Ø¯ Ø§Ù†ÙØ¬Ø§Ø± Ø³Ø±Ø§Ø³Ø±ÛŒ
  const bursts = [
    {x:W*0.5,  y:H*0.35, count:420, speed:[7,16]},
    {x:W*0.15, y:H*0.25, count:220, speed:[6,14]},
    {x:W*0.85, y:H*0.30, count:220, speed:[6,14]},
    {x:W*0.25, y:H*0.70, count:220, speed:[5,12]},
    {x:W*0.75, y:H*0.75, count:220, speed:[5,12]}
  ];

  const colors=['#2aa7ff','#7fe1a3','#ffd166','#ef476f','#8338ec','#00c2ff','#ff8fab','#80ed99','#ffd6a5','#caffbf'];
  const pieces=[];
  for(const b of bursts){
    for(let i=0;i<b.count;i++){
      const ang=Math.random()*Math.PI*2;
      const sp=b.speed[0]+Math.random()*(b.speed[1]-b.speed[0]);
      pieces.push({
        x:b.x, y:b.y,
        vx:Math.cos(ang)*sp, vy:Math.sin(ang)*sp,
        g:0.22+Math.random()*0.1,
        drag:0.985,
        w:3+Math.random()*8, h:6+Math.random()*16,
        r:Math.random()*6, vr:-0.45+Math.random()*0.9,
        life:1200+Math.random()*1400,
        c:colors[Math.floor(Math.random()*colors.length)]
      });
    }
  }

  let startTs=null;
  function draw(ts){
    if(startTs===null) startTs=ts;
    const dt = Math.min(32, ts - (draw._prevTs||ts));
    draw._prevTs = ts;

    ctx.clearRect(0,0,W,H);

    for(const p of pieces){
      p.vx *= p.drag; p.vy = p.vy * p.drag + p.g;
      p.x += p.vx; p.y += p.vy;
      p.r += p.vr;
      p.life -= dt;

      if(p.x < 0 || p.x > W){ p.vx *= -0.8; p.x=Math.max(0,Math.min(W,p.x)); }
      if(p.y > H){ p.vy *= -0.6; p.y = H; }

      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r);
      ctx.fillStyle=p.c; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
      ctx.restore();
    }

    for(let i=pieces.length-1;i>=0;i--){
      if(pieces[i].life<=0) pieces.splice(i,1);
    }

    if(ts - startTs < 6200 && pieces.length){
      confettiRaf = requestAnimationFrame(draw);
    }else{
      clearConfetti();
    }
  }
  confettiRaf = requestAnimationFrame(draw);

  showToast('Ø¢ÙØ±ÛŒÙ†! Û¸ Ù„ÛŒÙˆØ§Ù† Ú©Ø§Ù…Ù„ Ø´Ø¯ ğŸ‰');

  // Ù¾ÛŒØ§Ù… Ø¨Ø²Ø±Ú¯ Ø¯ÛŒØ±ØªØ± Ù…Ø­Ùˆ Ø´ÙˆØ¯
  setTimeout(()=>{ bigMsg.classList.remove('show'); bigMsg.style.opacity='0'; }, 5200);

  setTimeout(()=>{
    const el=stage.querySelector('.char-emoji');
    if(el){ el.textContent=CHARACTERS[selected].normal; el.classList.remove('happy'); }
  },1800);
}

// ===== init =====
renderGlasses(); renderStage(); renderPicker(); update();

// Ø§ÛŒÙ†Ù¾ÙˆØª ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ
const remInput = document.getElementById('remInput');
remInput.value = reminderMinutes;
remInput.addEventListener('change', ()=>{
  const val = Math.max(1, Number(remInput.value)||60);
  reminderMinutes = val;
  localStorage.setItem('remMinutes', String(val));
  showToast(`Ø²Ù…Ø§Ù† ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø±ÙˆÛŒ ${val} Ø¯Ù‚ÛŒÙ‚Ù‡ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯`);
});

// Ø±ÛŒØ³Øª
document.getElementById('reset').addEventListener('click',resetAll);
</script>
</body>
</html>
