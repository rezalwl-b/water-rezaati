<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÛŒØ§Ø¯Ø¢ÙˆØ± Û¸ Ù„ÛŒÙˆØ§Ù† Ø¢Ø¨ â€” Ù†ÙˆØ´ÛŒØ¯Ù† Ø¢Ø¨</title>
  <style>
    :root{--bg:#E9F7FF;--card:#ffffff;--accent:#2aa7ff;--glass-border:#c6e7ff;--water:#7fd3ff;--muted:#6b6b6b;font-family:'Vazirmatn',system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#f8ffff)}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:2rem}
    .card{width:100%;max-width:1000px;background:var(--card);border-radius:20px;box-shadow:0 10px 30px rgba(60,120,150,.12);padding:28px;display:grid;grid-template-columns:1fr 380px;gap:20px;align-items:start}
    h1{margin:0 0 6px 0;font-size:20px;text-align:right}
    p.lead{margin:0 0 18px 0;color:var(--muted);text-align:right}

    .glasses{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .glass{background:linear-gradient(180deg,rgba(255,255,255,.8),rgba(255,255,255,.6));border-radius:14px;padding:10px;border:2px solid var(--glass-border);display:flex;flex-direction:column;align-items:center;justify-content:flex-end;cursor:pointer;transition:transform .18s ease,box-shadow .18s}
    .glass:active{transform:scale(.98)}
    .glass .cup{width:100%;height:120px;border-radius:10px;position:relative;overflow:hidden;background:rgba(255,255,255,.5);display:flex;align-items:flex-end;justify-content:center}
    .water{position:absolute;left:0;right:0;bottom:0;height:0%;background:linear-gradient(180deg,var(--water),#56b8f0);transition:height .6s cubic-bezier(.2,.9,.3,1)}
    .label{margin-top:10px;font-weight:600;color:#0b6aa6}
    .glass.filled{box-shadow:0 8px 18px rgba(34,149,214,.12);border-color:rgba(42,167,255,.6)}

    .side{display:flex;flex-direction:column;gap:16px;align-items:stretch}
    .stage{display:flex;align-items:center;justify-content:center;min-height:220px;background:linear-gradient(180deg,#eafff1,#f6fff6);border:1px solid rgba(120,210,140,.18);border-radius:16px;position:relative;overflow:hidden}
    .char-emoji{font-size:140px;line-height:1;filter:drop-shadow(0 8px 16px rgba(0,0,0,.08));transition:transform .35s ease}
    .char-emoji.happy{transform:translateY(-8px) scale(1.1) rotate(-2deg)}
    .char-emoji.angry{animation:shake .6s ease;transform:scale(1.04)}
    @keyframes shake{0%,100%{transform:translateX(0) scale(1.04)}25%{transform:translateX(-6px) scale(1.04)}50%{transform:translateX(5px) scale(1.04)}75%{transform:translateX(-4px) scale(1.04)}}
    .spark{position:absolute;font-size:28px;opacity:0;transform:translate(-50%,-50%) scale(.6);animation:spark .9s ease forwards}
    @keyframes spark{to{opacity:1;transform:translate(-50%,-50%) scale(1);}}

    .meter{width:100%;height:12px;background:linear-gradient(90deg,#e6f7ff,#e6fff6);border-radius:10px;overflow:hidden}
    .meter>i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#7fe1a3);transition:width .6s cubic-bezier(.2,.9,.3,1)}

    .controls{display:flex;gap:8px}
    button{appearance:none;border:0;padding:10px 12px;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;color:var(--muted);border:1px solid #dfeffb}

    .char-picker{display:flex;gap:8px;flex-wrap:wrap}
    .char-card{display:flex;align-items:center;gap:8px;border:1px solid #e6eef7;border-radius:12px;padding:8px 10px;cursor:pointer;user-select:none}
    .char-card input{accent-color:var(--accent)}

    .toast{position:fixed;left:50%;top:18px;transform:translateX(-50%);background:#0b6aa6;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 10px 24px rgba(0,0,0,.12);opacity:0;pointer-events:none;transition:opacity .25s ease;z-index:11}
    .toast.show{opacity:1}

    #confetti{position:fixed;inset:0;pointer-events:none;z-index:10}
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <div class="toast" id="toast"></div>
  <div class="wrap">
    <div class="card">
      <div>
        <h1>ÛŒØ§Ø¯Ø¢ÙˆØ± Ù†ÙˆØ´ÛŒØ¯Ù† Ø±ÙˆØ²ÛŒ Û¸ Ù„ÛŒÙˆØ§Ù† Ø¢Ø¨</h1>
        <p class="lead">Ù‡Ø± Ù„ÛŒÙˆØ§Ù† Ø±Ø§ Ú©Ù‡ Ù†ÙˆØ´ÛŒØ¯ÛŒ Ø¨Ø²Ù† Ø±ÙˆÛŒØ´ ØªØ§ Ù¾Ø± Ø´ÙˆØ¯ â€” Â«Ø§Ù‚Ø§ÛŒ Ø±Ø¶Ø§Ø¦ØªÛŒÂ» (Ø­ÛŒÙˆØ§Ù† Ø§Ù†ØªØ®Ø§Ø¨ÛŒ) Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯!</p>
        <div class="glasses" id="glasses"></div>
        <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;align-items:center">
          <div style="text-align:right"><div style="font-size:13px;color:#6b6b6b">Ù†ÙˆØ´ÛŒØ¯Ù‡ Ø´Ø¯Ù‡</div><div id="count" style="font-weight:800;font-size:18px">0 / 8</div></div>
          <div style="flex:1"></div>
          <div class="controls">
            <button id="reset">ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬Ø¯Ø¯</button>
          </div>
        </div>
      </div>
      <aside class="side">
        <div class="stage" id="stage"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
          <div style="font-weight:800">Ù¾ÛŒØ´Ø±ÙØª Ø±ÙˆØ²</div>
          <div class="meter" style="flex:1"><i id="meterBar" style="width:0%"></i></div>
        </div>
        <div>
          <div style="font-weight:700;margin:6px 0 8px">Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø®ØµÛŒØª Â«Ø§Ù‚Ø§ÛŒ Ø±Ø¶Ø§Ø¦ØªÛŒÂ» ğŸ¾</div>
          <div class="char-picker" id="charPicker"></div>
        </div>
      </aside>
    </div>
  </div>
<script>
// ---- Characters with faces ----
const CHARACTERS={
  cat :{name:'Ú¯Ø±Ø¨Ù‡', normal:'ğŸ±', happy:'ğŸ˜º', angry:'ğŸ˜¾'},
  dog :{name:'Ø³Ú¯',   normal:'ğŸ¶', happy:'ğŸ¶', angry:'ğŸ˜ '},
  cow :{name:'Ú¯Ø§Ùˆ',  normal:'ğŸ®', happy:'ğŸ®', angry:'ğŸ˜ '},
  lion:{name:'Ø´ÛŒØ±',  normal:'ğŸ¦', happy:'ğŸ¦', angry:'ğŸ˜ '},
  panda:{name:'Ù¾Ø§Ù†Ø¯Ø§',normal:'ğŸ¼', happy:'ğŸ¼', angry:'ğŸ˜ '}
};
let selected=localStorage.getItem('char')||'cat';
let state=(()=>{try{const s=JSON.parse(localStorage.getItem('drinkState'));if(Array.isArray(s)&&s.length===8)return s.map(Boolean);}catch(e){}return Array(8).fill(false)})();

const glassesEl=document.getElementById('glasses');
const countEl=document.getElementById('count');
const meterBar=document.getElementById('meterBar');
const stage=document.getElementById('stage');
const toast=document.getElementById('toast');
const confettiCanvas=document.getElementById('confetti');
const ctx=confettiCanvas.getContext('2d');

function save(){localStorage.setItem('drinkState',JSON.stringify(state));localStorage.setItem('char',selected)}
function renderGlasses(){glassesEl.innerHTML='';for(let i=0;i<8;i++){const b=document.createElement('button');b.className='glass'+(state[i]?' filled':'');b.innerHTML=`<div class='cup'><div class='water' style='height:${state[i]?'85%':'0%'}'></div></div><div class='label'>Ù„ÛŒÙˆØ§Ù† ${i+1}</div>`;b.onclick=()=>toggle(i,b);glassesEl.appendChild(b)}}
function renderStage(){stage.innerHTML='';const span=document.createElement('span');span.className='char-emoji';span.textContent=CHARACTERS[selected].normal;stage.appendChild(span)}
function renderPicker(){const p=document.getElementById('charPicker');p.innerHTML='';for(const [k,v] of Object.entries(CHARACTERS)){const label=document.createElement('label');label.className='char-card';label.innerHTML=`<input type='radio' name='char' value='${k}' ${selected===k?'checked':''}> ${v.name}`;label.querySelector('input').onchange=()=>{selected=k;save();renderStage()};p.appendChild(label)}}

function showToast(m){toast.textContent=m;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),1300)}
function face(mode){const el=stage.querySelector('.char-emoji');if(!el)return;const f=CHARACTERS[selected];if(mode==='happy'){el.textContent=f.happy;el.classList.add('happy');setTimeout(()=>{el.textContent=f.normal;el.classList.remove('happy')},900)}
else if(mode==='angry'){el.textContent=f.angry;el.classList.add('angry');setTimeout(()=>{el.textContent=f.normal;el.classList.remove('angry')},900)}}
function sparkle(set=['âœ¨','ğŸ’–','ğŸ’¦']){for(let i=0;i<3;i++){const s=document.createElement('div');s.className='spark';s.textContent=set[i%set.length];s.style.left=(50+(Math.random()*40-20))+'%';s.style.top=(45+(Math.random()*30-15))+'%';stage.appendChild(s);setTimeout(()=>s.remove(),900)}}

function update(){const done=state.filter(Boolean).length;countEl.textContent=`${done} / 8`;meterBar.style.width=`${(done/8)*100}%`;if(done===8)celebrate()}
function toggle(i,el){const was=state[i];state[i]=!state[i];const w=el.querySelector('.water');el.classList.toggle('filled',state[i]);w.style.height=state[i]?'85%':'0%';save();if(state[i]){face('happy');sparkle(['âœ¨','ğŸ’–','ğŸ’¦']);showToast(`Ø§Ù‚Ø§ÛŒ Ø±Ø¶Ø§Ø¦ØªÛŒ (${CHARACTERS[selected].name}) Ø®ÙˆØ´Ø­Ø§Ù„ Ø´Ø¯!`)}else{face('angry');sparkle(['ğŸ’¢','ğŸ’¢','ğŸ˜¤']);showToast('Ø§Ù‚Ø§ÛŒ Ø±Ø¶Ø§Ø¦ØªÛŒ Ú¯ÙØª: ÙˆØ§Ø³Ù‡ Ú†ÛŒ Ø®Ø§Ù„ÛŒ Ú©Ø±Ø¯ÛŒ Ù„Ø§Ø´ÛŒØŸ! ğŸ˜ ')}update()}

function resetAll(){state=Array(8).fill(false);save();renderGlasses();update()}
function sizeCanvas(){confettiCanvas.width=window.innerWidth;confettiCanvas.height=document.body.scrollHeight}
addEventListener('resize',sizeCanvas);sizeCanvas();
function celebrate(){face('happy');sizeCanvas();const colors=['#2aa7ff','#7fe1a3','#ffd166','#ef476f','#8338ec','#00c2ff'];const pieces=Array.from({length:420},()=>({x:Math.random()*confettiCanvas.width,y:-20-Math.random()*confettiCanvas.height,w:5+Math.random()*7,h:8+Math.random()*14,vy:2+Math.random()*4,vx:-2+Math.random()*4,r:Math.random()*6,vr:-0.25+Math.random()*0.5,c:colors[Math.floor(Math.random()*colors.length)]}));const t0=performance.now();(function draw(t){ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);for(const p of pieces){p.y+=p.vy;p.x+=p.vx;p.r+=p.vr;if(p.y>confettiCanvas.height+30){p.y=-30;p.x=Math.random()*confettiCanvas.width}ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.r);ctx.fillStyle=p.c;ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);ctx.restore()}if(t-t0<5500)requestAnimationFrame(draw)})();showToast('Ø¢ÙØ±ÛŒÙ†! Û¸ Ù„ÛŒÙˆØ§Ù† Ú©Ø§Ù…Ù„ Ø´Ø¯ ğŸ‰');setTimeout(()=>{const el=stage.querySelector('.char-emoji');if(el){el.textContent=CHARACTERS[selected].normal;el.classList.remove('happy')}},1600)}

renderGlasses();renderStage();renderPicker();update();
document.getElementById('reset').addEventListener('click',resetAll);
</script>
</body>
</html>
